(n=>{try{class c{constructor(t){this.metrics={}}start(t){this.metrics[t="Client: "+t]||(this.metrics[t]={start:0,end:0,duration:0}),this.metrics[t].start=performance.now()}end(t){this.metrics[t="Client: "+t]&&(this.metrics[t].end=performance.now(),this.metrics[t].duration=this.metrics[t].end-this.metrics[t].start)}log(){var t,e=n.cmmvTelemetry;0<e?.length&&(t=this.metrics,this.metrics={},e.map(t=>this.metrics["Server: "+t.label]={start:t.startTime,end:t.endTime,duration:t.endTime-t.startTime}),this.metrics={...this.metrics,...t});let s=0;e=Object.keys(this.metrics).map(t=>{var e=this.metrics[t].duration;return s+=e,{Process:t,Duration:e.toFixed(2)+" ms"}});"dev"===process.env.NODE_ENV&&console.table(e)}}var t={app:null,socket:null,contractIndex:{},contracts:{},context:{},contextApp:null,loaded:!1,binds:{},telemetry:new c,initialize(t,e,s){this.telemetry.start("Initialize Frontend");try{t.config&&t.config.rpc&&t.config.rpc.enabled&&(this.telemetry.start("WebSocket Initialization"),this.socket=new WebSocket(window.location.href.replace("https","wss").replace("http","ws")),this.socket.addEventListener("message",this.parseMessage.bind(this)),this.socket.binaryType="arraybuffer",this.telemetry.end("WebSocket Initialization"))}catch(t){console.error(t)}"object"==typeof t&&(this.context=Object.assign(this.context,t)),document.addEventListener("DOMContentLoaded",()=>{this.processExpressions(),this.telemetry.log()}),this.telemetry.end("Initialize Frontend")},addContracts(t){this.telemetry.start("Load Contracts");try{for(var e in this.contractIndex=t.index,t.contracts){var s;t.contracts.hasOwnProperty(e)&&(s=protobuf.Root.fromJSON(t.contracts[e]),this.contracts[e]=s)}this.generateRPCBindings()}catch(t){console.error("Error loading contracts:",t)}this.telemetry.end("Load Contracts")},getContract(t){return this.contracts[t]},parseMessage(r){this.telemetry.start("Parse Message");try{var t=r.data instanceof ArrayBuffer?new Uint8Array(r.data):r.data;let s=this.contracts.ws.lookupType("WsCall").decode(t),n=Object.keys(this.contractIndex).find(t=>this.contractIndex[t].index===s.contract);var c=Object.keys(this.contractIndex[n].types).find(t=>this.contractIndex[n].types[t]===s.message);if(n&&c){let e=this.getContract(n).lookupType(c).decode(s.data);this.binds[n]&&this.binds[n][c]&&this.binds[n][c].forEach(t=>t.apply(this.contextApp,[e,r.socket]))}else console.error("Unknown contract or message type:",s.contract,s.message)}catch(t){console.error(t)}this.telemetry.end("Parse Message")},pack(t,e,s){try{var n,r,c,i,o;return this.contracts[t]&&this.contractIndex[t]?(r=(n=this.contractIndex[t])?.types[e],i=(c=this.contracts[t]?.lookupType(e))&&s?c.encode(s).finish():null,(o=(this.contracts.ws?.lookupType("WsCall"))?.encode({contract:n?.index,message:r,data:i&&i instanceof Uint8Array?i:new Uint8Array}).finish())?new Uint8Array(o):null):(console.error(`Not found in contract list ${t}.`+e),null)}catch(t){console.error(t)}},generateRPCBindings(){Object.keys(cmmv.contracts).forEach(s=>{let e=cmmv.contracts[s];e.nested&&Object.keys(e.nested).forEach(t=>{t=e.nested[t];t.nested&&Object.keys(t.nested).forEach(e=>{-1<e.indexOf("Request")?cmmv[e]=t=>{e.startsWith("Add")?this.rpc.add(s,e,t):e.startsWith("Update")?this.rpc.update(s,e,t):e.startsWith("Delete")&&this.rpc.delete(s,e,{id:t})}:e.indexOf("Response")&&this[e]&&"function"==typeof this[e]&&this.rpc.on(s,e,this[e])})})})},send(t){this.socket.send(t)},processExpressions(){this.telemetry.start("Process Expressions"),this.telemetry.start("CreateApp"),this.contextApp=this.reactive({$template:"#app",loaded:!0,...this,rpc:this.rpc,...this.context,mounted:this.mounted,created:this.created});var t=this.createApp(this.contextApp);this.telemetry.end("CreateApp"),"function"==typeof this.contextApp?.created&&(this.telemetry.start("Created Hook"),this.contextApp?.created(),this.telemetry.end("Created Hook")),this.telemetry.start("Mount App"),this.app=t.mount(),this.telemetry.end("Mount App"),"function"==typeof this.contextApp?.mounted&&(this.telemetry.start("Mounted Hook"),this.contextApp?.mounted(),this.telemetry.end("Mounted Hook")),this.telemetry.end("Process Expressions")},rpc:{get:(t,e)=>{t=cmmv.pack.call(cmmv,t,e);cmmv.send(t)},add:(t,e,s)=>{t=cmmv.pack.call(cmmv,t,e,{item:s});cmmv.send(t)},update:(t,e,s)=>{t=cmmv.pack.call(cmmv,t,e,{id:s.id,item:s});cmmv.send(t)},delete:(t,e,s)=>{t=cmmv.pack.call(cmmv,t,e,{id:s.id});cmmv.send(t)},on:(t,e,s)=>{cmmv.binds[t]||(cmmv.binds[t]={}),cmmv.binds[t][e]||(cmmv.binds[t][e]=[]),cmmv.binds[t][e].push(s)}}};if(n.cmmvSetup){var e={};if("object"==typeof n.cmmvSetup.__methods)for(var s in n.cmmvSetup.__methods)e[s]=new Function(`return (${n.cmmvSetup.__methods[s]})`)();var r=n.cmmvSetup.__mounted?new Function(`return (${n.cmmvSetup.__mounted})`)():null;n.cmmv=Object.assign({...e,mounted:r},cmmv,n.cmmvSetup,t),n.cmmv.initialize(n.cmmvSetup.__data||{})}else n.cmmv=Object.assign({},t),n.cmmv.initialize({})}catch(t){console.error(t)}})("undefined"!=typeof window?window:global);