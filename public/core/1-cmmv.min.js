(t=>{try{var e={app:null,socket:null,contractIndex:{},contracts:{},context:{},contextApp:null,loaded:!1,binds:{},initialize(t,e,n){this.socket=new WebSocket(window.location.href.replace("https","wss").replace("http","ws")),this.socket.addEventListener("message",this.parseMessage.bind(this)),this.socket.binaryType="arraybuffer","object"==typeof t&&(this.context=Object.assign(this.context,t)),document.addEventListener("DOMContentLoaded",this.processExpressions.bind(this))},addContracts(t){try{for(var e in this.contractIndex=t.index,t.contracts){var n;t.contracts.hasOwnProperty(e)&&(n=protobuf.Root.fromJSON(t.contracts[e]),this.contracts[e]=n)}this.generateRPCBindings()}catch(t){console.error("Error loading contracts:",t)}},getContract(t){return this.contracts[t]},parseMessage(c){try{var t=c.data instanceof ArrayBuffer?new Uint8Array(c.data):c.data;let n=this.contracts.ws.lookupType("WsCall").decode(t),s=Object.keys(this.contractIndex).find(t=>this.contractIndex[t].index===n.contract);var o=Object.keys(this.contractIndex[s].types).find(t=>this.contractIndex[s].types[t]===n.message);if(s&&o){let e=this.getContract(s).lookupType(o).decode(n.data);this.binds[s]&&this.binds[s][o]&&this.binds[s][o].forEach(t=>t.apply(this.contextApp,[e,c.socket]))}else console.error("Unknown contract or message type:",n.contract,n.message)}catch(t){console.error(t)}},pack(t,e,n){try{var s,c,o,r,a;return this.contracts[t]&&this.contractIndex[t]?(c=(s=this.contractIndex[t])?.types[e],r=(o=this.contracts[t]?.lookupType(e))&&n?o.encode(n).finish():null,(a=(this.contracts.ws?.lookupType("WsCall"))?.encode({contract:s?.index,message:c,data:r&&r instanceof Uint8Array?r:new Uint8Array}).finish())?new Uint8Array(a):null):(console.error(`Not found in contract list ${t}.`+e),null)}catch(t){console.error(t)}},generateRPCBindings(){Object.keys(cmmv.contracts).forEach(n=>{let e=cmmv.contracts[n];e.nested&&Object.keys(e.nested).forEach(t=>{t=e.nested[t];t.nested&&Object.keys(t.nested).forEach(e=>{-1<e.indexOf("Request")?cmmv[e]=t=>{e.startsWith("Add")?this.rpc.add(n,e,t):e.startsWith("Update")?this.rpc.update(n,e,t):e.startsWith("Delete")&&this.rpc.delete(n,e,{id:t})}:e.indexOf("Response")&&this[e]&&"function"==typeof this[e]&&this.rpc.on(n,e,this[e])})})})},send(t){this.socket.send(t)},processExpressions(){this.contextApp=this.reactive({$template:"#app",loaded:!0,...this,rpc:this.rpc,...this.context,mounted:this.mounted,created:this.created});var t=this.createApp(this.contextApp);"function"==typeof this.contextApp?.created&&this.contextApp?.created(),this.app=t.mount(),"function"==typeof this.contextApp?.mounted&&this.contextApp?.mounted()},rpc:{get:(t,e)=>{t=cmmv.pack.call(cmmv,t,e);cmmv.send(t)},add:(t,e,n)=>{t=cmmv.pack.call(cmmv,t,e,{item:n});cmmv.send(t)},update:(t,e,n)=>{t=cmmv.pack.call(cmmv,t,e,{id:n.id,item:n});cmmv.send(t)},delete:(t,e,n)=>{t=cmmv.pack.call(cmmv,t,e,{id:n.id});cmmv.send(t)},on:(t,e,n)=>{cmmv.binds[t]||(cmmv.binds[t]={}),cmmv.binds[t][e]||(cmmv.binds[t][e]=[]),cmmv.binds[t][e].push(n)}}},n={};if("object"==typeof __methods)for(var s in __methods)n[s]=new Function(`return (${__methods[s]})`)();var c=__mounted?new Function(`return (${__mounted})`)():null;t.cmmv=Object.assign({...n,mounted:c},cmmv,e),t.cmmv.initialize(__data||{})}catch(t){console.error(t)}})("undefined"!=typeof window?window:global);